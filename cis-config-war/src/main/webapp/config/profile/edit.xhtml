<ui:composition template="/template/main.xhtml"
 xmlns="http://www.w3.org/1999/xhtml"
 xmlns:h="http://xmlns.jcp.org/jsf/html"
 xmlns:f="http://xmlns.jcp.org/jsf/core"
 xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

 <f:metadata>
  <f:viewParam name="id" value="#{profileEdit.id}" required="true" requiredMessage="Pro editaci profilu je nutné zadat parametr id." />
  <f:viewAction action="#{profileEdit.init}" />
 </f:metadata>

 <ui:param name="pageName" value="Konfigurační profily" />
 <ui:param name="pageTitle" value="Editace položek profilu &quot;#{profileEdit.name}&quot;" />

 <ui:define name="content">
  <h:form onsubmit="#{profileEdit.refreshAddItemKeyForm()}">
   <h:panelGrid columns="2">
    <h:panelGroup>
     <h:outputLabel for="category" value="Kategorie" />
    </h:panelGroup>

    <h:panelGroup>
     <h:selectOneMenu id="category" value="#{profileEdit.selectedCategory}" onchange="submit();">
      <f:selectItem itemLabel="vyberte kategorii" itemValue="#{profileEdit.noneSelector}" />
      <f:selectItems value="#{profileEdit.allCategories}" var="category" itemLabel="#{category.name}" itemValue="#{category.id}" />
     </h:selectOneMenu>
    </h:panelGroup>

    <h:panelGroup>
     <h:outputLabel for="key" value="Klíč" />
    </h:panelGroup>

    <h:panelGroup>
     <h:selectOneMenu id="key" value="#{profileEdit.selectedItemKey}" onchange="submit();" disabled="#{profileEdit.keySelectorDisabled}">
      <f:selectItem itemLabel="vyberte klíč" itemValue="#{profileEdit.noneSelector}" />
      <f:selectItems value="#{profileEdit.filteredItemKeys}" var="itemKey" itemLabel="#{itemKey.key}" itemValue="#{itemKey.id}" />
     </h:selectOneMenu>
    </h:panelGroup>

    <h:panelGroup>
     <h:outputLabel for="value" value="Hodnota" />
    </h:panelGroup>

    <h:panelGroup>
     <h:inputText id="value" class="important" value="#{profileEdit.profileItemValue}" disabled="#{profileEdit.keyValueDisabled}"></h:inputText>
    </h:panelGroup>

    <h:panelGroup />

    <h:panelGroup>
     <h:commandButton action="#{profileEdit.actionAddProfileItem}" value="Přidat položku" />
    </h:panelGroup>
   </h:panelGrid>
  </h:form>

  <h:form>
   <h:commandButton action="#{profileEdit.actionSaveChanges}" value="Uložit změny" />

   <ui:param name="items" value="#{profileEdit.profileItems}" />

   <h:dataTable id="data-table" value="#{items}" var="item" rendered="#{not empty items}">
    <h:column>
     <f:facet name="header">ID</f:facet>
     <a id="item-#{item.id}" class="id"><h:outputText value="#{item.id}" /></a>
    </h:column>
    <h:column>
     <f:facet name="header">Klíč</f:facet>
     <h:outputText value="#{item.key.key}" />
    </h:column>
    <h:column>
     <f:facet name="header">Typ</f:facet>
     <h:outputText value="#{itemk.key.type}" />
    </h:column>
    <h:column>
     <f:facet name="header">Kategorie</f:facet>
     <h:outputText value="#{item.key.category.name}" />
    </h:column>
    <h:column>
     <f:facet name="header">Hodnota</f:facet>
     <h:outputText value="#{item.value}" />
    </h:column>

    <h:column>
     <h:commandLink action="#{profileEdit.actionDeleteItem}" value="smazat" rendered="#{!profileEdit.isDeletedItem(item.id)}">
      <f:setPropertyActionListener target="#{profileEdit.manipulationID}" value="#{item.id}" />
     </h:commandLink>
    </h:column>

    <h:column>
     <h:commandLink action="#{profileEdit.actionRestoreItem}" value="obnovit" rendered="#{profileEdit.isDeletedItem(item.id)}">
      <f:setPropertyActionListener target="#{profileEdit.manipulationID}" value="#{item.id}" />
     </h:commandLink>
    </h:column>
   </h:dataTable>
  </h:form>

  <ul>
   <li><h:link outcome="list" value="Zpět na seznam" /></li>
  </ul>
 </ui:define>
</ui:composition>
